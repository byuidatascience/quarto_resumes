---
format:
  html:
    toc: true
    grid:
      sidebar-width: 50px
      body-width: 800px
      margin-width: 200px
      gutter-width: 1.5rem
  pdf:
    pdf-engine: weasyprint
css: cv.css
execute:
  echo: false
format-links: [pdf]
---

```{python}
import polars as pl
from IPython.display import Markdown

def print_bullets(dat):
  nbullets = dat.shape[0]

  if nbullets == 1:
    str_out = f"""
- {dat.item(0,"bullets")}
"""
  elif nbullets == 2:
    str_out = f"""
- {dat.item(0,"bullets")}
- {dat.item(1,"bullets")}
"""
  elif nbullets == 3:
    str_out = f"""
- {dat.item(0,"bullets")}
- {dat.item(1,"bullets")}
- {dat.item(2,"bullets")}
"""
  elif nbullets == 4:
    str_out = f"""
- {dat.item(0,"bullets")}
- {dat.item(1,"bullets")}
- {dat.item(2,"bullets")}
- {dat.item(3,"bullets")}
"""
  elif nbullets >= 5:
    sys.exit("Too many bullets. Must be less than 5.")
  else:
    sys.exit("No bullets found.")
  return str_out

def work_chunk(work):
  if work.shape[0] == 0:
    return Markdown('')
  else:
    p1 = work.select('position').item()
    c1 = work.select('company').item()
    l1 = work.select('location').item()
    s1 = work.select(pl.col('start').dt.to_string("%b %Y")).item()
    e1 = work.select(pl.col('end').dt.to_string("%b %Y")).item()
    b1 = work.select('bullets').item().split("- ")
    b1df = pl.DataFrame({"bullets":b1})\
      .filter(pl.col("bullets").str.len_chars() > 1)
    btext = print_bullets(b1df)
  
    return Markdown(f'''### {p1}
  ***{c1}*** [{s1} -- {e1}]{{.cvdate}}
  ''' + btext)

projects = pl.read_parquet("default_tables/projects.parquet")
skills = pl.read_parquet("default_tables/skills.parquet")
work = pl.read_parquet("default_tables/work.parquet")
education = pl.read_parquet("default_tables/education.parquet")
contact = pl.read_parquet("default_tables/contact.parquet")

```

```{python}
#| tags: [parameters]
name_id = contact.select("name").item()
email_id = contact.select("email").item()
github_id = contact.select("github").item()
linkedin_id = contact.select("linkedin").item()
telephone_id = contact.select("phone").item()
```

```{python}
import sys
import polars as pl
from IPython.display import Markdown
```



`{python} Markdown(f'# {name_id}')`


:::: {.columns}

::: {.column width="22%"}
`{python} Markdown(f'[{email_id}](mailto:{email_id})')`
:::

::: {.column width="1%"}
:::

::: {.column width="22%"}
`{python} Markdown(f'[Github](https://github.com/{github_id})')`
:::

::: {.column width="1%"}
:::

::: {.column width="22%"}
`{python} Markdown(f'[LinkedIn.com](https://www.linkedin.com/in/{linkedin_id}/)')`
:::

::: {.column width="1%"}
:::


::: {.column width="22%"}
`{python} Markdown(f'[{telephone_id}](tel:{telephone_id})')`
:::


::::


## EDUCATION

```{python}
e1 = education.slice(0,1)
s1 = e1.select('school').item()
d1 = e1.select('degree').item()
ex1 = e1.select(pl.col('expected').dt.to_string("%b %Y")).item()
```

`{python} Markdown(f'**{d1}** <br> *{s1}* [*Expected: {ex1}*]')`{.cvdate}


## SKILLS

```{python}
#| output: asis
topics = skills.group_by("topic", maintain_order=True).len()
ntopics = topics.shape[0]

slist1 = skills\
  .join(topics.slice(0, 1), on='topic')\
  .with_columns(
    ("**"+pl.col("skill")+"**"+ " (" + pl.col("details") + ")")\
      .alias("skill_items"))\
  .select("skill_items").to_series().to_list()

slist2 = skills\
  .join(topics.slice(1, 1), on='topic')\
  .with_columns(
    ("**"+pl.col("skill")+"**"+ " (" + pl.col("details") + ")")\
      .alias("skill_items"))\
  .select("skill_items").to_series().to_list()

slist3 = skills\
  .join(topics.slice(2, 1), on='topic')\
  .with_columns(
    ("**"+pl.col("skill")+"**"+ " (" + pl.col("details") + ")")\
      .alias("skill_items"))\
  .select("skill_items").to_series().to_list()

slist4 = skills\
  .join(topics.slice(2, 1), on='topic')\
  .with_columns(
    ("**"+pl.col("skill")+"**"+ " (" + pl.col("details") + ")")\
      .alias("skill_items"))\
  .select("skill_items").to_series().to_list()

s1 = "- " + ", ".join(slist1)
s2 = "- " + ", ".join(slist2)
s3 = "- " + ", ".join(slist3)
s4 = "- " + ", ".join(slist4)

if ntopics == 1:
  out = Markdown(f"""
{s1}
""")
elif ntopics == 2:
  out = Markdown(f"""
{s1}
{s2}
""")
elif ntopics == 3:
  out = Markdown(f"""
{s1}
{s2}
{s3}
""")
elif ntopics == 4:
  out = Markdown(f"""
{s1}
{s2}
{s3}
{s4}
""")
else:
  sys.exit("Too many topics. At most 4.")

out
```

## WORK EXPERIENCE

```{python}
work1 = work.slice(0,1)
work2 = work.slice(1,1)
work3 = work.slice(2,1)
work4 = work.slice(3,1)
work5 = work.slice(4,1)
```


```{python}
work_chunk(work1)
```

```{python}
work_chunk(work1)
```

```{python}
work_chunk(work3)
```

```{python}
work_chunk(work4)
```

```{python}
work_chunk(work5)
```

## PROJECTS
```{python}
nprojects = projects.shape[0]

def projects_dat(projects):
  pr = projects
  pr_n = pr.select("name").item()
  pr_p = pr.select("purpose").item()
  pr_g = pr.select("github").item()
  pr_l = pr.select("languages").item()
  pr_s = pr.select(pl.col('start').dt.to_string("%b %Y")).item()
  pr_e = pr.select(pl.col('end').dt.to_string("%b %Y")).item()
  return pr_n, pr_p, pr_g, pr_l, pr_s, pr_e

```

<!-- project 1 -->

```{python}
#| output: asis
slice_input = min(0, nprojects - 1)
if nprojects < 1:
  out = print("<!--")
else:
  out = Markdown("")
out
```
```{python}
pr_n, pr_p, pr_g, pr_l, pr_s, pr_e = projects_dat(projects.slice(slice_input, 1))
```

:::: {.columns #vtop}
::: {.column width="68%"}

```{python}
Markdown(f'''***{pr_n}***   
*{pr_p}*
''')
```
:::

::: {.column width="30%"}
`{python} Markdown(f'[{pr_s} -- {pr_e}]{{.cvdate}}')`
:::
:::

`{python} Markdown(f'- {pr_l}: [Github Repository]({pr_g})')`

```{python}
#| output: asis
if nprojects < 1:
  out = print("-->")
else:
  out = Markdown("")
out
```

<!-- project 2 -->

```{python}
#| output: asis
slice_input = min(1, nprojects - 1)
if nprojects < 1:
  out = print("<!--")
else:
  out = Markdown("")
out
```
```{python}
pr_n, pr_p, pr_g, pr_l, pr_s, pr_e = projects_dat(projects.slice(slice_input, 1))
```

:::: {.columns #vtop}
::: {.column width="68%"}

```{python}
Markdown(f'''***{pr_n}***   
*{pr_p}*
''')
```
:::

::: {.column width="30%"}
`{python} Markdown(f'[{pr_s} -- {pr_e}]{{.cvdate}}')`
:::
:::

`{python} Markdown(f'- {pr_l}: [Github Repository]({pr_g})')`

```{python}
#| output: asis
if nprojects < 1:
  out = print("-->")
else:
  out = Markdown("")
out
```

<!-- project 3 -->

```{python}
#| output: asis
slice_input = min(2, nprojects - 1)
if nprojects < 3:
  out = print("<!--")
else:
  out = Markdown("")
out
```
```{python}
pr_n, pr_p, pr_g, pr_l, pr_s, pr_e = projects_dat(projects.slice(slice_input, 1))
```

:::: {.columns #vtop}
::: {.column width="68%"}

```{python}
Markdown(f'''***{pr_n}***   
*{pr_p}*
''')
```
:::

::: {.column width="30%"}
`{python} Markdown(f'[{pr_s} -- {pr_e}]{{.cvdate}}')`
:::
:::

`{python} Markdown(f'- {pr_l}: [Github Repository]({pr_g})')`

```{python}
#| output: asis
if nprojects < 3:
  out = print("-->")
else:
  out = Markdown("")
out
```


<!-- project 4 -->

```{python}
#| output: asis
slice_input = min(3, nprojects - 1)
if nprojects < 4:
  out = print("<!--")
else:
  out = Markdown("")
out
```
```{python}
pr_n, pr_p, pr_g, pr_l, pr_s, pr_e = projects_dat(projects.slice(slice_input, 1))
```

:::: {.columns #vtop}
::: {.column width="68%"}

```{python}
Markdown(f'''***{pr_n}***   
*{pr_p}*
''')
```
:::

::: {.column width="30%"}
`{python} Markdown(f'[{pr_s} -- {pr_e}]{{.cvdate}}')`
:::
:::

`{python} Markdown(f'- {pr_l}: [Github Repository]({pr_g})')`

```{python}
#| output: asis
if nprojects < 4:
  out = print("-->")
else:
  out = Markdown("")
out
```



<!-- ::: {.print-only .contact-block}

::: -->

<!-- ## WORK EXPERIENCE{style="page-break-before: always"} -->

<!-- ::: {.no-print}
::: -->

<!-- ::: {.print-only}
## References
Available upon request
::: -->


